% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Description of Numerical Model
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Numerical Model}
\label{model_chapter}

It's called Tuna! 

The code is linear! From here on, we're talking about perturbations from the zeroth-order magnetic field, which we assume to be an ideal dipole. This is a not-great assumption out towards the magnetopause. In practice, however, we mostly see wave activity around $L \lesssim \SI{7}{\RE}$, where the dipole approximation is pretty good. 

% =============================================================================
% =============================================================================
% =============================================================================
\section{Coordinate System}
  \label{model_grid_section}


Important to align our grid with the dipole field line, since we have empirical data for parallel and perpendicular conductivity and electric constant. 

Also important to take into account the effects of a constant-altitude ionosphere. It plays a significant role in the propagation of \Alfven waves. Also, going down to the ionosphere allows us to compute ground signatures. 

We use lowercase $x$, $y$, and $z$ to indicate field-aligned coordinates. The
unit vector \zhat is aligned with the dipole field (pointing outward in the
northern hemisphere and inward in the southern hemisphere), while \xhat and
\yhat are perpendicular to the dipole field; \xhat lies in the meridinal plane,
and \yhat in the azimuthal direction.

But we don't actually do calculations in $x$, $y$, $z$. 

% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
\subsection{Two and a Half Dimensions}

We resolve the meridional plane, then say everything goes as $e^{i \azm \phi}$. 

This prevents us from looking at the dayside and the nightside at the same time. 

As long as we're looking at phenomena which are azimuthally localized, we should be fine. And, as we discussed in ???, Pc4 pulsations are localized in MLT. 

This means we don't have to worry about derivatives in the azimuthal direction. We just use a factor of $i \azm$. 

While we can't resolve the azimuthal direction, we can look at phase. Imaginary values correspond to an azimuthal offset compared to the (real) driving. 

% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
\subsection{Nonorthogonal Dipole Grid}

It's convenient to align our grid to the zeroth-order field. This allows us to
decouple the parallel and perpendicular components of the permittivity and
conductivity tendors. Traditional dipole coordinates are written as (using $r$,
$\theta$, and $\phi$ in the usual spherical sense): 
\begin{align}
  \mu & = -\frac{\sin^2 \theta}{r} & \phi & = \phi & \nu & = \frac{\cos \theta}{r^2}
\end{align}

Notably, $\mu$ is constant over a given field line -- it can also be written as
$\frac{-1}{L}$, where $L$ is the McIlwain parameter. This makes it easy to
specify inner and outer boudaries. On the other hand, the natural choice for
boundaries in $\nu$ are the ionospheric current sheets. These sheets fall at 
(more or less) constant altitude, but not constant $\nu$. 

Following the example of (CITE Lysak 2004 !!!), $\nu$ can be rescaled to come to a
constant value at the ionospheric boundary. 
\begin{align}
  \label{def_coords}
  u^1 & = - \frac{R_I}{r} \sin^2 \theta & 
  u^2 & = \phi &
  u^3 & = \frac{R_I^2}{r^2} \frac{\cos \theta}{\cos \theta_0}
\end{align}

Here, $\theta_0$ is a field line's invariant colatitude; that is, the
colatitude at which it intersects the ionosphere. 

Note that $u^1$ is constant over each field line, $u^3 = 1$ where each field
line intersects the ionosphere in the northern hemisphere, and $u^3 = -1$ where
each field line intersects the ionosphere in the southern hemisphere. 

% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
\subsection{The Metric Tensor}

The coordinates defined in \cref{def_coords} are field-aligned, and come to a constant value at the ionosphere. Those are some pretty nice properties. But they're not orthonormal. That means we have to distinguish between covariant and contravariant coordinates. 

Compute covariant and contravariant basis vectors in terms of $u^i$...
\begin{align}
  \hat{e}_i & = \dd{u^i} \vec{x} & \hat{e}^i & = \dd{\vec{x}} u^i
\end{align}

Compute the metric tensor components in terms of the basis vectors... 
\begin{align}
  g_{ij} & = \hat{e}_i \cdot \hat{e}_j & g^{ij} & = \hat{e}^i \cdot \hat{e}^j
\end{align}

With a quick renormalization, we can map from these nonorthogonal coordinates to \xhat, \yhat, and \zhat. 
\begin{align}
  \xhat = \frac{ \hat{e}^1 }{ \sqrt{ g^{11} } } \equiv h_1 \hat{e}^1 &&
  \yhat = \frac{ \hat{e}^2 }{ \sqrt{ g^{22} } } \equiv h_2 \hat{e}^2 &&
  \zhat = \frac{ \hat{e}_3 }{ \sqrt{ g_{33} } } \equiv \frac{1}{h_3} \hat{e}_3
\end{align}

We can also map over to \rhat, \qhat, \fhat, though these expressions are only valid on the ionospheric boundary. 
\begin{align}
  \qhat = \frac{ \hat{e}_1 }{ \sqrt{ g_{11} } } \equiv \frac{1}{h_\theta} \hat{e}_1 &&
  \fhat = \frac{ \hat{e}_2 }{ \sqrt{ g_{22} } } \equiv \frac{1}{h_\phi} \hat{e}_2 &&
  \rhat = \frac{ \hat{e}^3 }{ \sqrt{ g^{33} } } \equiv h_r \hat{e}^3
\end{align}

In order to take derivatives with respect to these coordinates, we also need the determinant of the Jacobian matrix. 
\begin{align}
  \label{def_jacobian}
  \jac &= \hat{e}_1 \lr{ \hat{e}_2 \times \hat{e}_3 } = h_1 h_2 h_3
\end{align}

It's possible (if tedious) to crunch out $g$, $h$, and $\jac$ in terms of $r$, $\theta$, and $\phi$. They're probably in an appendix somewhere. 

% =============================================================================
% =============================================================================
% =============================================================================
\section{Ionospheric Profile}
  \label{model_ionos_section}

These profiles come from Kelley 1989. CITE!!!

There are four profiles, corresponding to quiet day, quiet night, calm day, calm night. 

% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
\subsection{Conductivity}

% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
\subsection{Number Density and Mean Molecular Mass}

Number density is the sum of a plasmaspheric profile and a ``auroral'' profile. 

The mean molecular mass is based on eyeballing from... Bob's 2004 paper? He gives characteristic values at a few different altitudes. This has no visible effect on the code. 

% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
\subsection{\Alfven Speed}

This section isn't about the electric constant, even though that's what we read in. If it were, we would have to talk about the Boris correction. That's a few sections later. 

We have a profile that we read in, from Kelley. 

We then add a density term. I guess Kelley's profile assumes low density, or was measured in a low density region? We use the number density discussed above, as well as the zeroth-order magnetic field strength, to compute the perpendicular electric constant. Then we use that to get the \Alfven speed. 

The Ionospheric \Alfven Resonator (IAR) is definitely included in this model, but it's not super important in practice. IAR modes resonate at $\sim\SI{1}{\Hz}$ and our driving is two orders of magnitude slower. 

% =============================================================================
% =============================================================================
% =============================================================================
\section{Driving with Current}
  \label{model_driving_section}

We have to get the energy in there somehow. Driving current is purely perpendicular. There is no component within the meridional plane (along the zeroth-order field or perpendicular to it). However, some effect is felt immediately on $E_x$ due to the Hall conductivity. 

% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
\subsection{Constraints on Compression}

In the past, similar work has been done using compressional driving. 

This constrains the values of \azm that can be looked at. At large \azm, \Alfven waves can't propagate across field lines. They become purely guided. 

We can do some runs to show that this is the case. Can we also get it to fall out of the dispersion relation? The one from the previous chapter, not the generic \Alfven wave one. 

It's appropriate to drive with current because Pc4 pulsations are known to interact with energetic particles from the ring current and radiation belts. 

Substorm injections can cause azimuthal asymmetry in the ring current. 

% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
\subsection{Calibration using Sym-H}

We look at Sym-H to get an idea of the appropriate scale for current driving. We look at a few storms. 1 June 2013. 17 March 2015. 22 June 2015. 17 March 2013. A few in October and November 2012. 

We plot the power spectrum and basically do a fit for the top of the range of $\frac{1}{f}$ noise. This gives us a typical magnitude for oscillations on the order of a minute. 

This doesn't give us a characteristic spatial extent for ring current modulations -- Sym-H is a global index -- but we can eyeball the size of current fluctuations. We know the approximate size of the ring current, so we can go from ground-based field signature to current density in space pretty easily. 

There are a lot of parameters to play with. Since this is a linear code, we don't have to worry about ``sweet spots'' for nonlinear effects in the driving magnitude. And it doesn't look like the exact position or shape of the ring current has much qualitative effect on what we see. 

Looking at SYMH. Fourier series out to a period of about a minute. The power spectrum (judging from June 1-3 2013) gives you ~$10^{-2} (T/minutes)$. We can hand-wave a mapping from SYMH to the ring current. 
\begin{align}
  B & = \frac{\mu_0 I}{2 R}
\end{align}

With $B \sim \SI{2}{\nano\tesla}$, $R \sim \SI{4}{\RE}$, $A \sim \SI{1}{\RE\squared}$, we end up with $J \sim \SI{e-4}{\micro\ampere/\meter\squared}$. 

% =============================================================================
% =============================================================================
% =============================================================================
\section{Maxwell's Equations}
  \label{model_equations_section}

The bulk of the model is just electric and magnetic fields sloshing back and forth according to Maxwell's equations. 

% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
\subsection{Perpendicular Electric Field}

Let's look at just the perpendicular component for the moment (with respect to the zeroth-order magnetic field). Recall that $\vec{B}$ and $\vec{E}$ are the first-order perturbations. 
\begin{align}
  \epsilon_\bot \ddt \vec{E}_\bot &= \frac{1}{\mu_0} \left( \curl{B} \right)_\bot - \vec{J}_\bot
\end{align}

We split the current into two terms: an Ohmic term, which we eliminate using Kirchoff's formulation of \ohmlaw ($\vec{J} = \tensor{\sigma} \cdot \vec{E}$), and a driving component. 
\begin{align}
  \epsilon_\bot \ddt \vec{E}_\bot &= \frac{1}{\mu_0} \left( \curl{B} \right)_\bot - \tensor{\sigma}_\bot \cdot \vec{E}_\bot - \vec{J}_{drive}
\end{align}

We rewrite this expression using the \Alfven speed, $v^2 \equiv \frac{1}{\mu_0 \epsilon_\bot}$. In addition, we take the shorthand $\vec{F} \equiv \curl{B} - \frac{1}{\epsilon_\bot} \vec{J}_{drive}$. 
\begin{align}
  \ddt \vec{E}_\bot &= v^2 \vec{F}_\bot - \frac{1}{\epsilon_\bot} \tensor{\sigma}_\bot \cdot \vec{E}_\bot
\end{align}

Note that $E_x$ and $E_y$ are coupled by the Hall conductivity in the ionosphere. They can be decoupled by a rotation. The differential equation can then be solved using integrating factors. 
\begin{align}
  \vec{E}_\bot \arg{\dt} &= 
    \tensor{R} \argsmall{\frac{\sigma_H}{\epsilon_\bot} \dt} \cdot \vec{E}_\bot \arg{0}
      \exp \argsmall{-\frac{\sigma_P}{\epsilon_\bot} \dt}
    + v^2 \dt \tensor{R} \argsmall{\frac{\sigma_H}{\epsilon_\bot} \frac{\dt}{2} } \cdot  \vec{F}_\bot \argsmall{ \frac{\dt}{2} } \exp \argsmall{-\frac{\sigma_P}{\epsilon_\bot} \frac{\dt}{2} }
\end{align}

Where $\tensor{R}$ is the 2D rotation matrix. In $x$-$y$ coordinates, that's...
\begin{align}
  \tensor{R} \lr{\theta} & = \mm{\cos\theta}{-\sin\theta}{\sin\theta}{\cos\theta}
\end{align}

We map from physical coordinates. Then we use the metric tensor to eliminate any contravariant terms. This cuts down on memory use as well as computation time. 
\begin{align}
  \begin{split}
    E_1 \arg{\dt} - \frac{g^{13}}{g^{11}} E_3 \arg{\dt}
      & = E_1 \arg{0} \cos \argsmall{\frac{\sigma_H}{\epsilon_\bot} \dt} 
        \exp \argsmall{-\frac{\sigma_P}{\epsilon_\bot} \dt} \\
      & + E_2 \arg{0} \sqrt{ \frac{g^{22}}{g^{11}} } 
        \sin \argsmall{\frac{\sigma_H}{\epsilon_\bot} \dt} 
        \exp \argsmall{-\frac{\sigma_P}{\epsilon_\bot} \dt} \\
      & + E_3 \arg{0} ...
  \end{split} \\
  \begin{split}
    E_2 \arg{\dt}
      & = E_1 \arg{0} \sqrt{ \frac{g^{11}}{g^{22}} } 
      \sin \argsmall{\frac{\sigma_H}{\epsilon_\bot} \dt} 
      \exp \argsmall{-\frac{\sigma_P}{\epsilon_\bot} \dt} \\
    & + E_2 \arg{0} \cos \argsmall{\frac{\sigma_H}{\epsilon_\bot} \dt} 
      \exp \argsmall{-\frac{\sigma_P}{\epsilon_\bot} \dt} \\
    & + E_3 \arg{0} ...
  \end{split}
\end{align}

where 

\begin{align}
  F^1 & = \frac{\partial_2 B_3 - \partial_3 B_2}{\jac} &
  F^2 & = \frac{\partial_3 B_1 - \partial_1 B_3}{\jac} - \frac{J^2_{drive}}{\epsilon_\bot} &
  F^3 & = \frac{\partial_1 B_2 - \partial_2 B_1}{\jac}
\end{align}

Note that (due to the integrating factors) the electric and magnetic fields are offset by half a time step. 

% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
\subsection{Parallel Electric Field and Parallel Current}

Parallel \amplaw. 
\begin{align}
  \epsilon_\parallel \ddt E_\parallel &= \frac{1}{\mu_0} \lr{ \curl{B} }_\parallel - J_\parallel
\end{align}

If we follow the same approach as above, we can also solve with integrating factors. There isn't even any rotation. 
\begin{align}
  E_\parallel \arg{\dt} &= E_\parallel \arg{0}
      \exp \argsmall{-\frac{\sigma_0}{\epsilon_\parallel} \dt}
    + v^2 \dt F_\parallel \argsmall{ \frac{\dt}{2} } 
    \exp \argsmall{-\frac{\sigma_0}{\epsilon_\parallel} \frac{\dt}{2} }
\end{align}

However, it turns out that the field-aligned conductivity is really big, and the parallel electric constant (assumed to be $\epsilon_0$) is pretty small. For each profile, we see $\frac{\sigma_0}{\epsilon_\parallel} \dt \gtrsim 10^3$. When the exponential is evaluated, it goes to zero. 

So, the above expression can't be used to compute parallel electric fields. 

We get around that by adding electron inertial effects to \ohmlaw. Recall that in generalized form, \ohmlaw is:
\begin{align}
  \vec{E} + \vec{U} \times \vec{B} & = 
  \eta \vec{J} + \frac{\me}{n e^2} \lrb{
    \ddt \vec{J} + \nabla \cdot \lr{ 
      \vec{J} \, \vec{U} + \vec{U} \,\vec{J} +
      \frac{1}{n e} \vec{J} \, \vec{J} } } +
  \frac{1}{n e} \vec{J} \times \vec{B} -
  \frac{1}{n e} \div{ \vec{P_e} }
\end{align}

We are using a cold, static plasma, so we get to ignore any terms with $\vec{U}$. We also skip the nonlinear terms... this can probably be justified through a scaling argument. 

The parallel conductivity is much larger than the Pedersen and Hall conductivities, which is how we can justify keeping only the parallel component of this term. 

After pulling the conductivity tensor out of the denominator, we are left with the same form as before, but with an added term representing electron intertia:
\begin{align}
  \ddt J_\parallel & = 
    \frac{n e^2}{\me} E_\parallel -
    \frac{n e^2}{\me \sigma_0} J_\parallel
\end{align}

Now we solve for $J_\parallel$ using integrating factors. 
\begin{align}
  J_\parallel \arg{\dt} & = 
    J_\parallel \arg{0} \exp \argsmall{ -\frac{n e^2}{\me \sigma_0} \dt }
    + \frac{n e^2}{\me} \dt \, E_\parallel \argsmall{\frac{\dt}{2}}  
    \exp \argsmall{ -\frac{n e^2}{\me \sigma_0} \frac{\dt}{2} }
\end{align}

Or, in covariant terms, 
\begin{align}
  \begin{split}
    J_3 \arg{\dt} & = 
      J_3 \arg{0} \exp \argsmall{ -\frac{n e^2}{\me \sigma_0} \dt } \\
      & + E_3 \argsmall{\frac{\dt}{2}} \frac{n e^2}{\me} \dt   
      \exp \argsmall{ -\frac{n e^2}{\me \sigma_0} \frac{\dt}{2} }
  \end{split}
\end{align}

We see the half-step offset again. The current lines up with the magnetic field. 

The electron inertial term of \ohmlaw describes plasma oscillation, which (naturally) happen at the plasma frequency. We expect this to be unstable unless $\dt < \frac{1}{ \omega_{p e} }$. We're off, by a lot. 

Reducing the time step by several orders of magnitude is not feasible. Much of what makes this model valuable is its speed -- the ability to conduct an ensemble of dozens of runs overnight -- and that would be lost if runs went from an hour to four days. This also risks instabilities of its own due to compounding numerical noise. 

The solution is to implement a Boris correction, as introduced in (CITE BORIS 1970!!!). We increase $\epsilon_\parallel$ above its previous value of $\epsilon_0$. This essentially drops the speed of light and the plasma frequency -- potentially by several orders of magnitude -- while leaving their ratio, the electron inertial length, unchanged. This can easily reduce the speed of light to less than the \Alfven speed! 

This is safe as long as we keep the plasma frequency well above Pc4 frequencies. This was shown in Lysak 2001 (CITE!!!). Also in Ronnmark (CITE!!!), who uses the nice term "anisotropic vacuum". 

To briefly summarize Lysak's argument for why this is safe, start with the same equations as above. And assume that we're oscillating at some frequency $\omega$. Then we can evaluate the time derivatives in \amplaw and \ohmlaw. Note that we bring in the electron-ion collision frequency $\nu = \frac{n e^2}{\me \sigma_0}$
\begin{align}
  \epsilon_\parallel \ddt E_\parallel & = 
    \frac{1}{\mu_0} \lr{ \curl{B} }_\parallel - J_\parallel &
  \ddt J_\parallel & = 
    \frac{n e^2}{\me} E_\parallel -
    \nu J_\parallel
\end{align}

So with the electron inertial length defined per $\lambda^2 \equiv \frac{c^2}{\omega_p^2} = \frac{\me}{n e^2 \mu_0}$...

\begin{align}
  \lrb{ 1 - \frac{\omega^2 - i \omega \nu}{\omega_p^2} } E_\parallel & =
  \lambda^2 \lr{\nu - i \omega} \lr{ \curl{B} }_\parallel
\end{align}

That is, as long as $\frac{\omega}{\omega_p^2} \ll 1$ and $\frac{\omega \nu}{\omega_p^2} \ll 1$ we should see no difference in the relative scales of the electric and magnetic fields. 

Notably, without the electron inertial term, the perpendicular expression has no $i \omega$ on the right hand side of the expression. That's probably fine. The (effective?) perpendicular collision frequency is very large. (It can't be a real collision frequency... it goes to infinity when number density gets tiny! Note that the different conductivities actually have quite different expressions when derived from first principles.)

% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
\subsection{Magnetic Field}

Magnetic fields are straightforward. Start with \farlaw. 
\begin{align}
  \ddt \vec{B} & = - \curl{E}
\end{align}

In covariant terms, this can be written as...
\begin{align}
  B_1 \arg{\dt} & = B_1 \lr{0} - \dt g_{11} C^1 \argsmall{\frac{\dt}{2}} 
    - \dt g_{13} C^3 \argsmall{\frac{\dt}{2}} \\
  B_2 \arg{\dt} & = B_2 \lr{0} - \dt g_{22} C^2 \argsmall{\frac{\dt}{2}} \\
  B_3 \arg{\dt} & = B_3 \lr{0} - \dt g_{31} C^1 \argsmall{\frac{\dt}{2}} 
    - \dt g_{33} C^3 \argsmall{\frac{\dt}{2}}
\end{align}

Where we have defined $C \equiv \curl{E}$ in order to avoid computing the same derivatives for both $B_1$ and $B_3$. 
\begin{align}
  C^1 & = \frac{\partial_2 E_3 - \partial_3 E_2}{\jac} &
  C^2 & = \frac{\partial_3 E_1 - \partial_1 E_3}{\jac} &
  C^3 & = \frac{\partial_1 E_2 - \partial_2 E_1}{\jac} 
\end{align}

% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
\subsection{Parity and Interpolation}

Each field component is stored at only one parity in each direction. This is because of how curls line up. Adjacent values of $E_2$ just aren't really coupled to each other. 

This means that computing all of the parities isn't just unnecessary -- it's potentially unstable. The odd-by-odd grid and the odd-by-even grid are only weakly coupled, especially at large $r$, so they can drift apart. This can lead to problems in places where they do care about one another. This is documented... where??? 

This would be perfectly true if we were taking curls on an orthonormal grid, and if there was no Hall conductivity. As is, it's still pretty true. The contributions of off-parity terms tend to be small. 

% =============================================================================
% =============================================================================
% =============================================================================
\section{Boundary Conditions}

The grid can't go on forever. There have to be special cases at the edges. 

% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
\subsection{Interpolation and Differentiation}

At the inner and outer boundaries (that is, along the innermost and outermost field lines), as use Dirichlet and Neumann boundary conditions for electric and magnetic fields respectively. 

These are implemented in the differentiation and (parity) interpolation functions. 

Whenever we need to know the magnetic field just outside the grid boundary, we say that its value is the same as just inside the grid boundary, and its derivative is zero. Neumann. 

Conversely, we say that the electric field just outside the grid goes to 0, allowing us to compute the derivative from the value just inside the grid. Dirichlet. 

Dirichlet and Neumann could be flipped without much consequence. They're sorta arbitrary. But mixing up a term, so that they are no longer self-consistent, causes instability. 

% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
% -----------------------------------------------------------------------------
\subsection{Coupling to the Atmosphere}

Per Maxwell's equations, $\div{B}=0$. We further assume that there are no currents flowing in the atmosphere, giving $\curl{B}=0$. These conditions together guarantee the existence of a scalar magnetic potential, $\Psi$, which satisfies Laplace's equation, $\nabla^2 \Psi = 0$ and $\vec{B} = \grad{\Psi}$. 

Separating out the $r$ and $\phi$ components of Laplace's equation, the $\theta$ component of the equation can be written as a differential equation in terms of $u \equiv \cos\theta$: 
\begin{align}
  \frac{d}{d u} \lr{ \lr{1 - u^2} \frac{d}{d u} Y_\nu } - \frac{m^2}{1 - u^2} Y_\nu & = - \nu \lr{\nu + 1} Y_\nu
\end{align}

This can be solved numerically on our discrete grid, providing us with eigenvectors and eigenvalues ($Y_\nu$ and $\nu$ respectively). We can then write $\Psi$ in terms of those harmonics: 
\begin{align}
  \Psi \lr{r, \theta} = & \displaystyle\sum_\nu \lr{ \alpha_\nu r^\nu + \beta_\nu r^{-\nu-1} } Y_\nu \lr{\theta}
\end{align}

We will rearrange this expression in order to compute $\Psi$ each time step as a linear combination of the radial magnetic field values at $R_I$. 

We defined $\vec{B} = \grad{\Psi}$, so $B_r = \dd{r} \Psi$. 

The ground is perfectly conducting, so $B_r \lr{R_E} = 0$. 

...

We don't need to show algebra, but we should show the final expression. 

...

Jump condition over the ionospheric current sheet. This comes from integrating \amplaw... ?

% =============================================================================
% =============================================================================
% =============================================================================
\section{Optimization of Model}

Get some MPI benchmarks for future work! Time to compute a million time steps versus time to broadcast a million time steps, as a function of grid size. This should imply a magic number where size overcomes the overhead from starting up communication. 

This doesn't actually belong here. 





